# Bheemverse Holding Company - Workspace Setup Plan

**Date:** December 9, 2025
**Domain:** bheem.co.uk
**Holding Company:** Bheemverse

---

## Overview

Setting up bheem.co.uk as the primary domain for Bheemverse holding company with:
- **Bheem Mail** - Professional email hosting
- **Bheem Docs** - Document management per user
- **Bheem Meet** - Video conferencing with room management
- **Bheem Calendar** - Shared calendars and scheduling

---

## PHASE 1: Email Hosting Setup (bheem.co.uk)

### Step 1.1: DNS Configuration

Add these DNS records to bheem.co.uk:

```dns
# MX Records (Mail Exchange)
@       MX      10      mail.bheem.cloud.

# SPF Record (Sender Policy Framework)
@       TXT     "v=spf1 mx a include:mail.bheem.cloud ~all"

# DKIM Record (will be generated by Mailcow)
dkim._domainkey     TXT     "<DKIM_KEY_FROM_MAILCOW>"

# DMARC Record
_dmarc  TXT     "v=DMARC1; p=quarantine; rua=mailto:admin@bheem.co.uk"

# Autodiscover for Outlook
autodiscover    CNAME   mail.bheem.cloud.
autoconfig      CNAME   mail.bheem.cloud.

# Optional: Direct mail subdomain
mail    CNAME   mail.bheem.cloud.
```

### Step 1.2: Add Domain to Mailcow

```bash
# Via Mailcow API
curl -X POST "https://mail.bheem.cloud/api/v1/add/domain" \
  -H "X-API-Key: BheemMailAPI2024Key" \
  -H "Content-Type: application/json" \
  -d '{
    "domain": "bheem.co.uk",
    "description": "Bheemverse Holding Company",
    "aliases": 100,
    "mailboxes": 50,
    "defquota": 3072,
    "maxquota": 10240,
    "quota": 51200,
    "active": 1,
    "restart_sogo": 1
  }'
```

### Step 1.3: Generate DKIM Key

```bash
# Via Mailcow API
curl -X POST "https://mail.bheem.cloud/api/v1/add/dkim" \
  -H "X-API-Key: BheemMailAPI2024Key" \
  -H "Content-Type: application/json" \
  -d '{
    "domain": "bheem.co.uk",
    "dkim_selector": "dkim",
    "key_size": 2048
  }'

# Get DKIM record to add to DNS
curl -X GET "https://mail.bheem.cloud/api/v1/get/dkim/bheem.co.uk" \
  -H "X-API-Key: BheemMailAPI2024Key"
```

### Step 1.4: Create Mailboxes

**Recommended mailboxes for Bheemverse:**

| Email | Name | Quota | Role |
|-------|------|-------|------|
| admin@bheem.co.uk | Admin | 10GB | Super Admin |
| sundeep@bheem.co.uk | Sundeep | 10GB | Director |
| info@bheem.co.uk | Info | 5GB | General Inquiries |
| support@bheem.co.uk | Support | 5GB | Customer Support |
| hr@bheem.co.uk | HR | 5GB | Human Resources |
| finance@bheem.co.uk | Finance | 5GB | Accounts |

```bash
# Create mailbox via API
curl -X POST "https://mail.bheem.cloud/api/v1/add/mailbox" \
  -H "X-API-Key: BheemMailAPI2024Key" \
  -H "Content-Type: application/json" \
  -d '{
    "local_part": "sundeep",
    "domain": "bheem.co.uk",
    "name": "Sundeep",
    "password": "SecurePassword123!",
    "password2": "SecurePassword123!",
    "quota": 10240,
    "active": 1,
    "force_pw_update": 0,
    "tls_enforce_in": 1,
    "tls_enforce_out": 1
  }'
```

---

## PHASE 2: Bheemverse Organization Structure

### 2.1: Database Schema for Multi-Tenant

```sql
-- Create Bheemverse company in ERP
INSERT INTO public.companies (name, code, domain, email, is_active)
VALUES ('Bheemverse', 'BVERSE', 'bheem.co.uk', 'admin@bheem.co.uk', true);

-- Create organization hierarchy
CREATE TABLE IF NOT EXISTS workspace.organizations (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    domain VARCHAR(255) UNIQUE,
    parent_id INTEGER REFERENCES workspace.organizations(id),
    company_id INTEGER REFERENCES public.companies(id),
    settings JSONB DEFAULT '{}',
    created_at TIMESTAMP DEFAULT NOW()
);

-- User workspace assignments
CREATE TABLE IF NOT EXISTS workspace.user_workspaces (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES auth.users(id),
    organization_id INTEGER REFERENCES workspace.organizations(id),
    role VARCHAR(50) DEFAULT 'member',
    storage_quota BIGINT DEFAULT 5368709120, -- 5GB default
    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(user_id, organization_id)
);
```

### 2.2: User Structure for Bheemverse

```
Bheemverse (Holding Company)
â”œâ”€â”€ Directors
â”‚   â””â”€â”€ sundeep@bheem.co.uk (Super Admin)
â”œâ”€â”€ Departments
â”‚   â”œâ”€â”€ Administration
â”‚   â”‚   â””â”€â”€ admin@bheem.co.uk
â”‚   â”œâ”€â”€ Human Resources
â”‚   â”‚   â””â”€â”€ hr@bheem.co.uk
â”‚   â”œâ”€â”€ Finance
â”‚   â”‚   â””â”€â”€ finance@bheem.co.uk
â”‚   â””â”€â”€ Operations
â”‚       â”œâ”€â”€ info@bheem.co.uk
â”‚       â””â”€â”€ support@bheem.co.uk
â””â”€â”€ Subsidiary Companies (Future)
    â”œâ”€â”€ Bheem Cloud
    â”œâ”€â”€ Bheem ERP
    â””â”€â”€ Other ventures
```

---

## PHASE 3: Per-User Resource Management

### 3.1: Nextcloud User Provisioning

For each Bheemverse user, automatically create:

```bash
# Create Nextcloud user via OCS API
curl -X POST "https://docs.bheem.cloud/ocs/v2.php/cloud/users" \
  -u "admin:password" \
  -H "OCS-APIREQUEST: true" \
  -d "userid=sundeep@bheem.co.uk" \
  -d "password=SecurePassword123!" \
  -d "email=sundeep@bheem.co.uk" \
  -d "displayName=Sundeep" \
  -d "quota=10GB"

# Create personal folder structure
/Bheemverse
  /sundeep@bheem.co.uk
    /Documents
    /Projects
    /Shared
    /Meeting Recordings
```

### 3.2: Per-User Resources Table

```sql
CREATE TABLE IF NOT EXISTS workspace.user_resources (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES auth.users(id),

    -- Email
    email_address VARCHAR(255),
    email_quota_mb INTEGER DEFAULT 5120,
    email_used_mb INTEGER DEFAULT 0,

    -- Documents
    docs_username VARCHAR(255),
    docs_quota_gb INTEGER DEFAULT 5,
    docs_used_gb DECIMAL(10,2) DEFAULT 0,
    docs_folder_path VARCHAR(500),

    -- Meetings
    can_host_meetings BOOLEAN DEFAULT true,
    max_meeting_duration INTEGER DEFAULT 60, -- minutes
    max_participants INTEGER DEFAULT 10,
    recording_enabled BOOLEAN DEFAULT true,

    -- Calendar
    calendar_id VARCHAR(255),
    can_create_events BOOLEAN DEFAULT true,

    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

### 3.3: Meeting Room Management

```sql
-- Company meeting rooms
CREATE TABLE IF NOT EXISTS workspace.company_meeting_rooms (
    id SERIAL PRIMARY KEY,
    organization_id INTEGER REFERENCES workspace.organizations(id),
    room_name VARCHAR(255) NOT NULL,
    room_code VARCHAR(50) UNIQUE,
    description TEXT,
    capacity INTEGER DEFAULT 10,
    is_permanent BOOLEAN DEFAULT false,
    settings JSONB DEFAULT '{
        "require_password": false,
        "waiting_room": true,
        "auto_recording": false,
        "screen_share_allowed": true
    }',
    created_by INTEGER REFERENCES auth.users(id),
    created_at TIMESTAMP DEFAULT NOW()
);

-- Room bookings
CREATE TABLE IF NOT EXISTS workspace.room_bookings (
    id SERIAL PRIMARY KEY,
    room_id INTEGER REFERENCES workspace.company_meeting_rooms(id),
    organizer_id INTEGER REFERENCES auth.users(id),
    title VARCHAR(255),
    start_time TIMESTAMP NOT NULL,
    end_time TIMESTAMP NOT NULL,
    attendees JSONB DEFAULT '[]',
    meeting_link VARCHAR(500),
    status VARCHAR(20) DEFAULT 'scheduled',
    created_at TIMESTAMP DEFAULT NOW()
);
```

---

## PHASE 4: Automated User Onboarding

### 4.1: User Provisioning API

When a new user is added to Bheemverse:

```python
async def provision_bheemverse_user(
    email: str,
    name: str,
    department: str,
    role: str = "member"
):
    """
    Automatically provision all workspace resources for new user
    """
    domain = email.split('@')[1]
    username = email.split('@')[0]

    # 1. Create ERP user account
    user_id = await create_erp_user(email, name, company_id=BHEEMVERSE_ID)

    # 2. Create mailbox in Mailcow
    await mailcow_service.create_mailbox(
        local_part=username,
        domain=domain,
        password=generate_temp_password(),
        name=name,
        quota=5120  # 5GB
    )

    # 3. Create Nextcloud account
    await nextcloud_service.create_user(
        username=email,
        password=generate_temp_password(),
        email=email,
        display_name=name,
        quota="5GB"
    )

    # 4. Create personal calendar
    await caldav_service.create_calendar(
        username=email,
        calendar_name="Personal",
        color="#667eea"
    )

    # 5. Create document folders
    await nextcloud_service.create_folder(email, password, "/Documents")
    await nextcloud_service.create_folder(email, password, "/Projects")
    await nextcloud_service.create_folder(email, password, "/Meeting Recordings")

    # 6. Add to company shared folder
    await share_folder_with_user(
        folder="/Bheemverse/Shared",
        user=email,
        permission="read"
    )

    # 7. Send welcome email
    await send_welcome_email(email, name, temp_password)

    return user_id
```

### 4.2: Welcome Email Template

```html
Subject: Welcome to Bheemverse - Your Workspace is Ready!

Dear {name},

Welcome to Bheemverse! Your unified workspace has been set up.

ğŸ“§ Email: {email}
   Access: https://mail.bheem.cloud

ğŸ“ Documents: https://docs.bheem.cloud
   Username: {email}

ğŸ“… Calendar: https://workspace.bheem.cloud/calendar

ğŸ¥ Meetings: https://workspace.bheem.cloud/meet

Your temporary password: {temp_password}
Please change it on first login.

Single Sign-On: Use your credentials at https://workspace.bheem.cloud
to access all services seamlessly.

Best regards,
Bheemverse IT Team
```

---

## PHASE 5: Implementation Steps

### Step-by-Step Execution

```bash
# Step 1: Configure DNS (Do this in domain registrar)
# Add MX, SPF, DKIM, DMARC records

# Step 2: Add domain to Mailcow
ssh -i /root/.ssh/sundeep root@135.181.25.62
# Run domain addition commands

# Step 3: Create admin mailbox first
# sundeep@bheem.co.uk as super admin

# Step 4: Create Bheemverse organization in ERP
PGPASSWORD='Bheem924924.@' psql -h 65.109.167.218 -U postgres -d erp_staging
# Run SQL to create company and organization

# Step 5: Create Nextcloud group for Bheemverse
ssh -i /root/.ssh/sundeep root@46.62.165.32
docker exec nextcloud-app php occ group:add "Bheemverse"

# Step 6: Deploy user provisioning API
# Add endpoint to workspace backend

# Step 7: Test with first user (sundeep@bheem.co.uk)
```

---

## PHASE 6: Admin Dashboard Features

### 6.1: Bheemverse Admin Panel

Features to add:
- **User Management**
  - Add/remove users
  - Set quotas per user
  - View usage statistics

- **Email Management**
  - Domain settings
  - Alias management
  - Email forwarding rules

- **Document Management**
  - Shared folder permissions
  - Storage quotas
  - Version control settings

- **Meeting Management**
  - Permanent room creation
  - Recording access control
  - Usage analytics

### 6.2: Usage Dashboard

```
Bheemverse Workspace Usage
==========================

Users: 6 active
Email Storage: 12.5 GB / 50 GB
Document Storage: 8.2 GB / 100 GB
Meetings This Month: 24
Total Recording Storage: 15 GB

Per-User Breakdown:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User                â”‚ Email     â”‚ Docs     â”‚ Meetings â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ sundeep@bheem.co.uk â”‚ 2.1 GB    â”‚ 3.5 GB   â”‚ 12       â”‚
â”‚ admin@bheem.co.uk   â”‚ 1.5 GB    â”‚ 1.2 GB   â”‚ 5        â”‚
â”‚ hr@bheem.co.uk      â”‚ 0.8 GB    â”‚ 0.5 GB   â”‚ 3        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Quick Start Commands

```bash
# 1. Add bheem.co.uk domain to Mailcow
ssh -i /root/.ssh/sundeep root@135.181.25.62 "cd /opt/mailcow && \
  curl -X POST 'http://localhost:8080/api/v1/add/domain' \
  -H 'X-API-Key: BheemMailAPI2024Key' \
  -H 'Content-Type: application/json' \
  -d '{\"domain\":\"bheem.co.uk\",\"description\":\"Bheemverse\",\"active\":1}'"

# 2. Create first mailbox
ssh -i /root/.ssh/sundeep root@135.181.25.62 "cd /opt/mailcow && \
  curl -X POST 'http://localhost:8080/api/v1/add/mailbox' \
  -H 'X-API-Key: BheemMailAPI2024Key' \
  -H 'Content-Type: application/json' \
  -d '{\"local_part\":\"sundeep\",\"domain\":\"bheem.co.uk\",\"name\":\"Sundeep\",\"password\":\"CHANGE_ME\",\"password2\":\"CHANGE_ME\",\"quota\":10240,\"active\":1}'"

# 3. Get DKIM record for DNS
ssh -i /root/.ssh/sundeep root@135.181.25.62 "cd /opt/mailcow && \
  curl -X GET 'http://localhost:8080/api/v1/get/dkim/bheem.co.uk' \
  -H 'X-API-Key: BheemMailAPI2024Key'"
```

---

## Summary

| Phase | Task | Time Estimate |
|-------|------|---------------|
| 1 | DNS + Domain Setup | 30 mins |
| 2 | Mailbox Creation | 15 mins |
| 3 | Nextcloud User Setup | 15 mins |
| 4 | Database Schema | 20 mins |
| 5 | User Provisioning API | 1 hour |
| 6 | Admin Dashboard | 2 hours |

**Total: ~4 hours for complete setup**

---

Ready to proceed? I can execute Phase 1 (DNS guidance + Mailcow domain setup) immediately.
